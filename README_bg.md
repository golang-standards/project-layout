# Стандартно оформление на Go проект

Преводи:

* [한국어 문서](README_ko.md)
* [简体中文](README_zh.md)
* [正體中文](README_zh-TW.md)
* [简体中文](README_zh-CN.md) - ???
* [Français](README_fr.md)
* [日本語](README_ja.md)
* [Portuguese](README_ptBR.md)
* [Español](README_es.md)
* [Română](README_ro.md)
* [Русский](README_ru.md)
* [Türkçe](README_tr.md)
* [Українська](README_ua.md)
* [Български](README_bg.md)

## Общ преглед

Това е основен макет за проекти на Go. Това **`не е официален стандарт, определен от основния екип на Go dev`**; обаче, това е набор от общи исторически и появяващи се макети на проекти в екосистемата на Go. Някои от тези модели са по-популярни от другите. Също така има множество малки подобрения заедно с няколко поддържащи директории, общи за всеки, достатъчно голямо реално приложение.

**`Ако се опитвате да научите Go или ако създавате PoC или прост проект за себе си, този проектен макет е излишен. Започнете с нещо много просто вместо това (един `main.go` файл и `go.mod` е повече от достатъчно).`** Когато проектът ви расте, имайте предвид, че ще е важно да се уверите, че вашият код е добре структуриран, иначе ще се състоите с разхвърлян код с много скрити зависимости и глобално състояние. Когато имате повече хора, които работят по проекта, ще ви трябва още повече структура. Това е когато е важно да се въведе общ начин за управление на пакети/библиотеки. Когато имате отворен източник или когато знаете, че други проекти импортват код от вашето репозитори, тогава е важно да имате частни (т. нар. `internal`) пакети и код. Клонирайте репозиторито, запазете каквото ви трябва и изтрийте всичко останало! Просто защото е там, не означава, че трябва да използвате всичко. Нито един от тези модели не се използва във всеки един проект. Дори моделът `vendor` не е универсален.

С Go 1.14 [`Go Modules`](https://github.com/golang/go/wiki/Modules) накрая са готови за производство. Използвайте [`Go Modules`](https://blog.golang.org/using-go-modules), освен ако нямате конкретна причина да не го правите, и ако го правите, не е необходимо да се притеснявате за $GOPATH и къде да поставите проекта си. Основният `go.mod` файл в репото предполага, че вашият проект се хоства на GitHub, но това не е задължително. Модулният път може да бъде всякакъв, но първият компонент на модулния път трябва да има точка в името си (текущата версия на Go вече не го изисква, но ако използвате малко по-стари версии, не се чудете ако вашите билдове са неусспешни без него). Вижте проблеми [`37554`](https://github.com/golang/go/issues/37554) и [`32819`](https://github.com/golang/go/issues/32819), ако искате да знаете повече.

Този план за проект е умишлено общ и не се опитва да въведе конкретен пакет за Go структура.

Това е обществен проект. Отворете въпрос/проблем, ако видите нов шаблон или ако мислите, че един от съществуващите шаблони трябва да бъде актуализиран.

Ако имате нужда от науменуване, форматиране и стил, започнете да изпълнявате [`gofmt`](https://golang.org/cmd/gofmt/) и [`golint`](https://github.com/golang/lint). Също така се уверете, че сте прочели следните насоки и препоръки за стил на кода в Go:
* https://talks.golang.org/2014/names.slide
* https://golang.org/doc/effective_go.html#names
* https://blog.golang.org/package-names
* https://github.com/golang/go/wiki/CodeReviewComments
* [Насока за стил на пакети в Go](https://rakyll.org/style-packages) (rakyll/JBD)

Вижте [`Go Project Layout`](https://medium.com/golang-learn/go-project-layout-e5213cdcfaa2) за допълнителна информация.

Повече за именуването и организирането на пакети, както и други препоръки за структурата на кода:
* [GopherCon EU 2018: Питър Бургон - Най-добрите практики за промишлено програмиране](https://www.youtube.com/watch?v=PTE4VJIdHPg)
* [GopherCon Russia 2018: Ашли Макнамара + Брайън Кетелсън - Най-добрите практики за Go](https://www.youtube.com/watch?v=MzTcsI6tn-0)
* [GopherCon 2017: Едуард Мюлър - Go Анти-шаблони](https://www.youtube.com/watch?v=ltqV6pDKZD8)
* [GopherCon 2018: Кат Зиен - Как структурирате вашите Go приложения](https://www.youtube.com/watch?v=oL6JBUk6tj0)

Китайска публикация за правила за пакетно ориентиран дизайн и слоеве на архитектура
* [Дизайн и архитектура ориентирани към пакети](https://github.com/danceyoung/paper-code/blob/master/package-oriented-design/packageorienteddesign.md)

## Go директории

### `/cmd`


Основни приложения за този проект.

Името на директорията за всяко приложение трябва да съвпада с името на изпълнимия файл, който искате да имате (например, `/cmd/myapp`).

Не вкарвайте много код в директорията за приложения. Ако мислите, че кодът може да бъде импортнат и използван в други проекти, тогава той трябва да бъде в директорията `/pkg`. Ако кодът не е повтаряем или ако не искате другите да го повтарят, поставете този код в директорията `/internal`. Ще се изненадате от това, което другите ще направят, така че бъдете категорични за вашите намерения!

Обикновено има малка функция `main`, която импортва и извиква кода от директориите `/internal` и `/pkg` и нищо друго.

Вижте директорията [`/cmd`](cmd/README.md) за примери.

### `/internal`

Частно приложение и код на библиотеката. Това е кодът, който не искате другите да импортват в своите приложения или библиотеки. Имайте предвид, че този макет на модела е принудително изпълнен от компилатора на Go. Вижте бележките за пускане на Go 1.4 [`release notes`](https://golang.org/doc/go1.4#internalpackages) за повече подробности. Имайте предвид, че не сте ограничени само до главната директория `internal`. Можете да имате повече от един `internal` директория на всяко ниво на дървото от проекта ви.

Можете да добавите допълнителна структура за вашите вътрешни пакети, за да разделите вашия споделен и несподелен вътрешен код. Не е задължително (особено за по-малки проекти), но е приятно да има визуални признаци, показващи предназначеното използване на пакета. Вашият действителен код на приложението може да бъде в директорията `/internal/app` (например, `/internal/app/myapp`) и кодът, споделен от тези приложения, в директорията `/internal/pkg` (например, `/internal/pkg/myprivlib`).

### `/pkg`

Код на библиотеката, който може да се използва от външни приложения (например, `/pkg/mypubliclib`). Други проекти ще импортнат тези библиотеки, очаквайки да работят, така че два пъти помислете преди да поставите нещо тук :-) Имайте предвид, че директорията `internal` е по-добър начин да се гарантира, че вашите частни пакети не са импортируеми, защото това е принудително изисквано от Go. Блогът [`I'll take pkg over internal`](https://travisjeffery.com/b/2019/11/i-ll-take-pkg-over-internal/) на Травис Джефери предоставя добър преглед на директориите `pkg` и `internal` и кога може да има смисъл да се използват.

Това също е начин да групирате кода на Go на едно място, когато вашата главна директория съдържа много не-Go компоненти и директории, което прави по-лесно изпълнението на различни Go инструменти (както е обяснено в тези доклади: [`Най-добрите практики за промишлено програмиране`](https://www.youtube.com/watch?v=PTE4VJIdHPg) от GopherCon EU 2018, [GopherCon 2018: Кат Зиен - Как структурирате вашите Go приложения](https://www.youtube.com/watch?v=oL6JBUk6tj0) и [GoLab 2018 - Масимилиано Пипи - Модели на подредба на проекти в Go](https://www.youtube.com/watch?v=3gQa1LWwuzk)).

Вижте директорията [`/pkg`](pkg/README.md), ако искате да видите кои популярни Go репозиторита използват този модел за оформление на проекта. Това е често срещан модел, но не е приет от всички в общността на Go и някои не го препоръчват.

Не е необходимо да го използвате, ако вашият проект е много малък и допълнително ниво на влагане не добавя много стойност (освен ако наистина искате :-)). Помислете над това, когато проектът ви стане достатъчно голям и вашата основна директория стане много заета (особено ако имате много не-Go компоненти).

Произходът на директорията `pkg`: Старият Go основен код използваше `pkg` за своите пакети, а след това различни проекти в общността започнаха да копират шаблона (вижте [това](https://twitter.com/bradfitz/status/1039512487538970624) туит на Брад Фитцпатрик за повече информация).

### `/vendor`


Зависимости на приложението (управлявани ръчно или чрез любимият ви инструмент за управление на зависимостите, като новата вградена функция [`Go Modules`](https://github.com/golang/go/wiki/Modules). Командата `go mod vendor` ще създаде директорията `/vendor` за вас. Имайте предвид, че може да се наложи да добавите флага `-mod=vendor` към вашата команда `go build`, ако не използвате Go 1.14, в която е включена по подразбиране.

Не комитвайте зависимостите на приложението, ако създавате библиотека.

От [`1.13`](https://golang.org/doc/go1.13#modules) Go също разреши възможността за модулен прокси (използвайки [`https://proxy.golang.org`](https://proxy.golang.org) като техен модулен прокси сървър по подразбиране). Прочетете повече за това [`тук`](https://blog.golang.org/module-mirror-launch), за да видите дали той отговаря на всички ваши изисквания и ограничения. Ако да, тогава няма да ви трябва директорията `vendor` изобщо.

## Директории на приложение за услуги

### `/api`

OpenAIAPI/Swagger спецификации, файлове с JSON схема, файлове за дефиниция на протокол. 

Вижте директорията [`/api`](api/README.md) за примери.

## Директории на уеб приложения

### `/web`

Компоненти, специфични за уеб приложение: статични уеб активи, шаблони от страна на сървъра и SPA.

## Общи директории на приложения

### `/configs`

Шаблони на конфигурационни файлове или конфигурации по подразбиране.

Поставете вашите файлове с шаблони `confd` или `consul-template` тук.

### `/init`

Конфигурации за стартиране на системата (systemd, upstart, sysv) и мениджър/надзорник на процеси (runit, supervisord).

### `/scripts`

Скриптове за извършване на различни операции по изграждане, инсталиране, анализ и т.н.

Тези скриптове поддържат Makefile на основно ниво малък и прост (напр. [`https://github.com/hashicorp/terraform/blob/master/Makefile`](https://github.com/hashicorp/terraform/blob/master/Makefile)).

Вижте директорията [`/scripts`](scripts/README.md) за примери.

## `/build`

Опаковане и постоянно интегриране.

Поставете вашите конфигурации в облак (AMI), контейнер (Docker), OS (deb, rpm, pkg) пакети и скриптове в директорията `/build/package`.

Поставете вашите конфигурации и скриптове за CI (travis, circle, drone) в директорията `/build/ci`. Имайте предвид, че някои от инструментите за CI (например, Travis CI) са много избирателни за местоположението на техните конфигурационни файлове. Опитайте да поставите конфигурационните файлове в директорията `/build/ci`, като ги свържете с местоположението, в което инструментите за CI очакват да бъдат (когато е възможно).

### `/deployments`

Конфигурации и шаблони за внедряване на IaaS, PaaS, система и оркестрация на контейнери (docker-compose, kubernetes/helm, mesos, terraform, bosh). Обърнете внимание, че в някои репота (особено приложения, внедрени с kubernetes) тази директория се нарича `/deploy`.

### `/test`

Допълнителни външни тестови приложения и тестови данни. Чувствайте се свободни да структурирате директорията `/test` по ваш вкус. За по-големи проекти има смисъл да има поддиректория. Например, можете да имате `/test/data` или `/test/testdata`, ако искате Go да игнорира каквото има в тази директория. Имайте предвид, че Go ще игнорира и директории или файлове, които започват с "." или "_", така че имате по-голяма флексибилност във връзка с именуването на директорията с тестови данни.

Вижте директорията [`/test`](test/README.md) за примери.

## Други директории

### `/docs`

Проектни и потребителски документи (в допълнение към документацията, генерирана от godoc).

Вижте директорията [`/docs`](docs/README.md) за примери.

### `/tools`

Поддържащи инструменти за този проект. Имайте предвид, че тези инструменти могат да импортват код от директориите `/pkg` и `/internal`.

Вижте директорията [`/tools`](tools/README.md) за примери.

### `/examples`

Примери за вашите приложения и/или публични библиотеки.

Вижтед директорията [`/examples`](examples/README.md) за примери.

### `/third_party`

Външен спомагателен тул, разклонен код и други помощни програми на трети страни (напр. Swagger UI).

### `/githooks`

Гит хуукс.

### `/assets`

Други активи, които да вървят заедно с вашето репозитори (изображения, лога и т.н.).

### `/website`

Това е мястото да поставите данните за уебсайта на вашия проект, ако не използвате страници на GitHub.

Вижте директорията [`/website`](website/README.md) за примери.

## Директории, които не трябва да имате

### `/src`

Някои Go проекти имат `src` папка, но това обикновено се случва, когато разработчиците идват от Java света, където това е обичайна практика. Ако можете да си помогнете, опитайте да не приемате този Java модел. Наистина не искате вашият Go код или Go проекти да изглеждат като Java :-)

Не бъркайте проектното ниво директория `/src` с директорията `/src`, която Go използва за работните си пространства, както е описано в [`How to Write Go Code`](https://golang.org/doc/code.html). Променливата `$GOPATH` сочи към вашето (текущо) работно пространство (по подразбиране тя сочи към `$HOME/go` в не-Windows системи). Това работно пространство включва горните `/pkg`, `/bin` и `/src` директории. Вашият действителен проект става поддиректория на `/src`, така че ако имате директория `/src` във вашия проект пътят на проекта ще изглежда така: `/some/path/to/workspace/src/your_project/src/your_code.go`. Имайте предвид, че с Go 1.11 е възможно да имате вашия проект извън вашия `GOPATH`, но това все още не означава, че е добра идея да се използва този шаблон.

## Значки

* [Go Report Card](https://goreportcard.com/) - Ще сканира вашия код с `gofmt`, `go vet`, `gocyclo`, `golint`, `ineffassign`, `license` и `misspell `. Заменете `github.com/golang-standards/project-layout` с препратката към вашия проект.

    [![Go Report Card](https://goreportcard.com/badge/github.com/golang-standards/project-layout?style=flat-square)](https://goreportcard.com/report/github.com/golang-standards/project-layout)

* ~~[GoDoc](http://godoc.org) - Ще предостави онлайн версия на вашата документация, генерирана от GoDoc. Променете връзката, за да сочи към вашия проект.~~

    [![Go Doc](https://img.shields.io/badge/godoc-reference-blue.svg?style=flat-square)](http://godoc.org/github.com/golang-standards/project-layout)

* [Pkg.go.dev](https://pkg.go.dev) - Pkg.go.dev е нова дестинация за Go discovery & docs. Можете да създадете значка с помощта на [инструмента за генериране на значки](https://pkg.go.dev/badge).

    [![PkgGoDev](https://pkg.go.dev/badge/github.com/golang-standards/project-layout)](https://pkg.go.dev/github.com/golang-standards/project-layout)

* Издаване - Ще покаже последния номер на изданието за вашия проект. Променете връзката към github, за да сочи към вашия проект.

    [![Release](https://img.shields.io/github/release/golang-standards/project-layout.svg?style=flat-square)](https://github.com/golang-standards/project-layout/releases/latest)

## Бележки

По-убедителен шаблон за проект с примерни/многократно използвани конфигурации, скриптове и код е WIP.
